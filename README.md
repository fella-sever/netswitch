### основное
1. используемое оборудование
- orange pi R1 plus lts
- модем ZTE https://www.ozon.ru/product/4g-wifi-modem-router-zte-79u-ru-pod-bezlimitnyy-internet-lyubaya-sim-i-tarif-593630602/?sh=hRIISKBThw
в настройках модема изменена подсеть на 192.168.1.1
- работа тестировалась с сотовыми операторами магефон и йота
- адаптер питания 5В 3А
- TF card SanDisk/Transcend 8/32 Gib
2. программное обеспечение
- ОС Armbian 23.02 Jammy 5.15
- Firewall ufw
- vmagent--linux-arm64-1.88-binary
- victoriametrics-linux-amd64-1.88-binary
- networkSwitcher
- dnmasq
3. Настройки SSH
- запрещен доступ по руту
- доступ через порт 2125
- авторизация через ключи
4. Настройки Ufw
- разрешен доступ из внутренней сети через сетефой интерфейс lan0
- доступ во внешнюю сеть разрешен через интерфейсы wan0 и eth0
- разрешены порты 2125 для ссх, 53 порт lan0 для работы dnsmasq, порт 8428 и порт 8229
для работы виктории
5. Кастомные настройки ipatables
- nat eth0 wan0
- форвардинг lan0
- создан сервис для загрузки скрипта, который добавляет правила при запуске системы
6. vmagent
- добавлен сервис для загрузки агента мониторинга со стартом системы
- конфигурационный файл расопложен в домашней директории пользователя
7. netSwitcher
- сервер работает на порту 8080
- по умолчанию активен канал связи через интерфейс eth0 как основной
### механика работы переключения сети

Дефолтные адреса сетей демо-образа:  
eth0 - 192.168.0.0 dhcp предоставляется внешним маршрутизатором
wan0 - 192.168.1.0 dhcp предоставляется usb модемом
lan0 - 19.168.25.1 static 

параметры dhcp сервера lan0 - диапазон 192.168.25.50-192.168.25.100

Утилита переключения предполагает использование трех режимов работы - автоперключение,
выбор основного или резервного каналов связи пользователем через api утилиты. 

Переключение каналов связи осуществляется повышением или понижение метрики 
маршрута основного канала связи. По умолчанию метрика основного 100, резервного 101.

В зависимости от метрик сети, которые предоставляет машина пинга с дефолтными 
параметрами пинга восьмерок 10 пакетами с интервалом в 0.2 секунды. В случае 
неактивного основного канала (отсутствие питания) свитчер переключает маршрут на 
резервный до тех пор, пока заданные пользователем пороги качества связи не будут 
удовлетворяться.  

Метрики: минимальное время отклика и процент потери пакетов. В случае, если одна 
из метрик превышает заданные пороги в атоматическом режиме - происходит 
переключение маршрута

API сервера

192.168.0.5:8080/get_info - получение информации о метриках на текущий момент, 
режим переключения сети, установленные пороги превышения метрик  

{  
"rtt_settings"                 
"packet_loss_settings_percent"   
"rtt_ms"                       
"packet_loss_percent"          
"alive_main_network"           
"alive_reserve_network"        
"pinger_count"         
"pinger_interval_ms"           
"network_switch_mode"          
"current_interface"  
}

192.168.0.5:8080/set_network_mode - установка режима переключения сети, валидация 
допускает три варианта - auto, main, reserve 

{  
"network_switch_mode": "auto"  
}  

192.168.0.5:8080/set_threshold - установка порогов превышения метрик  

{  
"rtt_settings_ms": 120,  
"packet_loss_percent": 50,  
"pinger_count": 10,  
"pinger_interval_ms": 20  
}


  


